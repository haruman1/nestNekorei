import{r,j as t,C as S}from"./index-DUYgz4DX.js";import{a as y,S as i}from"./sweetalert2.esm.all-CuWp6mgg.js";import{c as U,X as R,C as Q,a as X,b as G,d as J,e as V}from"./index.es-1bR-T9a-.js";import{C as W}from"./index.esm-BkRuN5E1.js";import{H as _}from"./Helmet-BCsUD1--.js";import{I as v,a as Y,b as Z}from"./imagekitio-react.esm-DOjWZMN7.js";import{a as ee}from"./CContainer-GNVW4D65.js";import{C as te,a as ae}from"./CCardBody-DdTLzXxm.js";import{C as oe}from"./CCardHeader-Bq8JZLL-.js";import{C as u}from"./CButton-9FYNAaZ7.js";import{b as c}from"./CFormInput-D4p5AKqz.js";import"./DefaultLayout-Cd14-C43.js";import"./CNavLink-AJqTeTjP.js";import"./Transition-B8X7oyuP.js";import"./cil-user-Ddrdy7PS.js";import"./isInViewport-BGGX6NGH.js";const je=()=>{const[I,T]=r.useState(null);r.useState(null);const[x,n]=r.useState(!0),[B,D]=r.useState([]),[E,C]=r.useState([]),[A,F]=r.useState(""),[L,j]=r.useState(!0),[M,p]=r.useState(!1),[o,q]=r.useState(null),[l,f]=r.useState({name:"",description:"",price:"",quantity:"",sku:"",categoryId:"",image:""}),h=e=>{console.log("Error",e)},k=e=>{n(!1),console.log("Success",e)},[z,b]=r.useState(!1),$=async()=>{try{const e=await fetch("http://localhost:3001/users/image/auth");if(!e.ok){const K=await e.text();throw new I(`Request failed with status ${e.status}: ${K}`)}const a=await e.json(),{signature:s,expire:m,token:P}=a;return{signature:s,expire:m,token:P}}catch(e){h(`Authentication request failed: ${e.message}`),T("Gagal mengupload foto, server sedang bermasalah")}},H=async()=>{o.action==="delete"?await y.delete(`http://localhost:3001/products/${o.id}`,{headers:{Authorization:"Bearer "+localStorage.getItem("authToken")}}).then(e=>{e.status===200?(k(e),g(),i.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:s=>{s.onmouseenter=i.stopTimer,s.onmouseleave=i.resumeTimer}}).fire({icon:"success",title:e.data.message}),setTimeout(()=>{n(!1)},3e3)):(i.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:s=>{s.onmouseenter=i.stopTimer,s.onmouseleave=i.resumeTimer}}).fire({icon:"error",title:e.data.message}),setTimeout(()=>{n(!1)},3e3))}).catch(e=>{h(e),i.fire("Error","Failed to Delete produk karena "+e.response.message,"error")}):o.action==="edit"&&await y.patch(`http://localhost:3001/products/${o.id}`,l,{headers:{Authorization:"Bearer "+localStorage.getItem("authToken")}}).then(e=>{e.status===200&&(k(e),g(),i.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:s=>{s.onmouseenter=i.stopTimer,s.onmouseleave=i.resumeTimer}}).fire({icon:"success",title:e.data.message}),setTimeout(()=>{n(!1)},3e3))}).catch(e=>{h(e),i.fire("Error","Failed to update product karena "+e.response.message,"error")}),p(!1)},g=async()=>{n(!0),j(!0);try{const e=await y.get("http://localhost:3001/products",{headers:{Authorization:"Bearer "+localStorage.getItem("authToken")}});if(e.data.status===200){const a=e.data.data;D(a),C(a)}}catch(e){console.error("Error fetching data:",e)}finally{n(!1),j(!1)}},d=e=>{const{name:a,value:s}=e.target;f({...l,[a]:s})},N=e=>{const a=e.target.value.toLowerCase();F(a);const s=B.filter(m=>m.name.toLowerCase().includes(a)||m.description.toLowerCase().includes(a)||m.id.toLowerCase().includes(a)||m.categoryId.toLowerCase().includes(a));C(s)},w=(e,a)=>{a==="edit"&&f({name:e.name,description:e.description,price:e.price,quantity:e.quantity,sku:e.sku,categoryId:e.categoryId,image:e.image}),q({...e,action:a}),p(!0)};r.useEffect(()=>{g()},[]);const O=[{name:"No",cell:(e,a)=>a+1,width:"50px",sortable:!1},{name:"ID",selector:e=>e.id,sortable:!0,width:"140px"},{name:"Name",selector:e=>e.name,sortable:!0,width:"150px"},{name:"Description",selector:e=>e.description,width:"160px",cell:e=>e.description.slice(0,10)+"..."},{name:"Price",selector:e=>`Rp.${parseFloat(e.price).toFixed(2)}`,sortable:!0,width:"120px"},{name:"Quantity",selector:e=>e.quantity,sortable:!0,width:"100px"},{name:"SKU",selector:e=>e.sku,width:"80px"},{name:"Category ID",selector:e=>e.categoryId,width:"120px"},{name:"Image",selector:e=>e.image?t.jsx(v,{urlEndpoint:"https://ik.imagekit.io/Nekorei",children:t.jsx(Z,{src:e.image,transformation:[{height:40,width:40}],loading:"lazy",height:"40",width:"40"})}):t.jsx("img",{src:"https://via.placeholder.com/40x40",alt:"placeholder"}),width:"80px",style:{textAlign:"center"}},{name:"Actions",cell:e=>t.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"10px"},children:[t.jsx(u,{variant:"outline",color:"info",size:"sm",onClick:()=>w(e,"edit"),children:"Edit"}),t.jsx(u,{variant:"outline",color:"danger",size:"sm",onClick:()=>w(e,"delete"),children:"Delete"})]}),width:"150px"}];return t.jsxs(t.Fragment,{children:[t.jsxs(_,{children:[t.jsx("title",{children:"List Produk - Nekorei Management"}),t.jsx("meta",{name:"description",content:"List Produk yang tersedia di Nekoreishion Management"})]}),t.jsx(ee,{children:t.jsxs(te,{children:[t.jsx(oe,{children:t.jsx("h3",{children:"List Produk"})}),t.jsxs(ae,{children:[t.jsx(u,{color:"primary",onClick:g,disabled:x,style:{float:"right"},children:x?t.jsx(S,{size:"sm"}):t.jsx(W,{icon:U})}),t.jsx(c,{type:"text",placeholder:"Search by Name, Description, or ID...",value:A,onChange:N,style:{marginBottom:"20px",padding:"5px",width:"300px"}}),x?t.jsx(S,{color:"primary"}):t.jsx(R,{columns:O,data:E,progressPending:L,pagination:!0,highlightOnHover:!0,pointerOnHover:!0,responsive:!0,striped:!0,customStyles:{cells:{style:{padding:"8px 10px"}}}})]})]})}),t.jsxs(Q,{backdrop:"static",visible:M,onClose:()=>p(!1),children:[t.jsx(X,{children:t.jsx(G,{children:(o==null?void 0:o.action)==="delete"?"Confirm Delete":"Edit Product"})}),t.jsx(J,{children:(o==null?void 0:o.action)==="delete"?`Are you sure you want to delete the product ${o==null?void 0:o.name}?`:t.jsxs(t.Fragment,{children:[t.jsx(c,{label:"Name",name:"name",value:l.name,onChange:d,style:{marginBottom:"10px"}}),t.jsx(c,{label:"Description",name:"description",value:l.description,onChange:d,style:{marginBottom:"10px"}}),t.jsx(c,{label:"Price",name:"price",type:"number",value:l.price,onChange:d,style:{marginBottom:"10px"}}),t.jsx(c,{label:"Quantity",name:"quantity",type:"number",value:l.quantity,onChange:d,style:{marginBottom:"10px"}}),t.jsx(c,{label:"SKU",name:"sku",value:l.sku,onChange:d,style:{marginBottom:"10px"}}),t.jsx(c,{label:"Category ID",name:"categoryId",value:l.categoryId,onChange:d,style:{marginBottom:"10px"}}),t.jsx(v,{publicKey:"public_QnAbe++JoAakOIvBBpsbOxvkLPk=",urlEndpoint:"https://ik.imagekit.io/Nekorei",authenticator:$,style:{width:"100%"},children:t.jsxs("label",{style:{display:"inline-block",position:"relative",overflow:"hidden",cursor:"pointer",fontFamily:"Arial, sans-serif",padding:"10px 20px",backgroundColor:z?"#0056b3":"#007bff",color:"#fff",borderRadius:"5px",fontSize:"16px",fontWeight:"600",textAlign:"center",transition:"background-color 0.3s ease"},onMouseEnter:()=>b(!0),onMouseLeave:()=>b(!1),children:[t.jsx(Y,{style:{position:"absolute",top:0,right:0,margin:0,padding:0,fontSize:"20px",cursor:"pointer",opacity:0},type:"file",accept:"image/*",onError:h,folder:"/products",onUploadStart:e=>(n(!0),console.log(e)),onSuccess:e=>(n(!1),console.log(e),f(a=>({...a,image:e.url})))}),"Upload an Image"]})})]})}),t.jsxs(V,{children:[t.jsx(u,{color:"secondary",onClick:()=>p(!1),children:"Cancel"}),t.jsx(u,{color:"primary",onClick:H,children:(o==null?void 0:o.action)==="delete"?"Delete":"Save Changes"})]})]})]})};export{je as default};
